hey everyone david shapiro here back with uh auto muse so uh we've done parts one and two this has taken a lot of work um and i've done a little bit of work um in the background just because i didn't wanna bore the audience with um with some nitty-gritty stuff but let me show you what i've done so first i think it'll make sense to let me just show you what the output is and then we'll work backwards just because there's a lot here and without a guide like a orientation it's not going to make a lot of sense okay so there are there's two folders that have the the kind of like final fine-tuned data and it's prompts and completions and so if you're not familiar with gpt3 yet there's a prompt which is the input and then the completion which is the output input output so basically what i've done is all of this goes to creating an input like this outline dorian gray is a young man who is incredibly handsome etc etc story so far so this is chunk number 23 the passage discusses the uselessness of art and how it is seen as a form of autobiography etc etc so this was created by the function called recursive summarization it needs a lot of work this is this is probably not going to work but we're going to see it through to the end and see how it goes so there's the outline which is included in every input so that way gpt3 knows the whole story the story so far so this is a summary of summaries so basically it's it what this is supposed to represent is what has happened in the story so far you can see here that it's a little bit too compacted so we're probably going to need to change that in the training data that's okay um and then the last chunk this is this is the most recent 1500 characters of prose that was written and so then what we ask it to do is write the next chunk and so we're on dorian gray 23 so this is paired with the completion dorian gray 23 so they have the same file name um but so you see here like the painter laughed i don't think there will be any difficulty about that sit down again harry blah blah with the single exception of myself dorian gray stepped up on dot dot dot the dice with the heir of the young greek martyr okay so you can see where it just continues one after the other so this has been formatted into the actual training data called novel.json l and so it's all nice and compacted into json format but this is like a human readable version and i split it up this way rather than just going straight to json l so that because this is so complicated you need to be able to see like okay this is what it's actually going to look like and i've got the fine tune running let's see if it's done still running okay so while that's running in the background we will go over um all the things that i've done and what we can do to test this is we'll put we'll we'll just copy paste this because we know what what we expect the output to be so we'll once we've got the fine-tuned model we'll do this and then put it in and see how close it is it's going to be awful um but you know because like we're basically trying to train da vinci um to write a novel in chunks from you know 280 samples um okay but first let me just give you a little bit of background so in the last video a few of you pointed out that um like dracula and and sherlock were not good examples because they're they're um uh dracula bram stoker's dracula is ephemera right so it's not like a conventional novel i think i'm saying that word right um but basically it's like it's it's transactions right it's like letters and newspaper clippings it's not it's not a conventional novel and neither is sherlock sherlock is a compendium so it's like okay let's get seven actual novels because that's what we're trying to do so let's train it only on novels so i went and got a few different books i went and made their outlines here so that's all the same i split all the books up into chunks so each of these chunks is 1500 characters long and then we did summaries of each of those chunks so each of these well i did i did up to 40 because we're not gonna i didn't want to do like the whole the whole novel um so we did we did 40 uh 40 summarize the first 40 chunks of each of them and then um to do then we got the the prompts and completions um so let me show you the scripts that i wrote to do this so first is so i've got these in order so from the top books to chunks summarize chunks excuse me recursive summaries format the json l and then fine tune and then wow excuse me i always get hiccups when i start talking so then after this we'll write another script to actually use the model but um we can i can it'll probably make more sense to just show you the novel the the model on the playground once it's done so i might not worry about that script just yet um i might just write that offline and do that in a fourth video or pause this one and do it anyways okay so uh from the top to overall review this is what we did so this first one books to chunks what it does is it goes to this folder books it just grabs the books one at a time you can see um files equals os lister books for file and files open the book and then we use text wrap for chunks of 1500 and that generates the uh the chunks here and so each chunk is just going to be it's going to end and begin and end on whole words it's not going to cut the words in half so you see in this case it's um it the the total length is 1500 1559 characters so basically it says like okay we're going to go closest to that console line i think there's other settings you can do to like how how wide is the console width or something along those lines anyways it's a super handy dandy thing to just split up text so use this use this module text wrap i think it's built into python i don't think i needed to install that okay so script one book to chunks just splits it up also let me check the volume okay um yeah because the last one was a little bit saturated so i turned the gain down a little bit i hope this sounds good um i've had all kinds of issues there was a bad cable um then then my computer turned the the volume of the microphone down like the levels it was down to like 58 so some videos were quiet i think it's okay anyways sorry quick aside um so second script summarize the chunks so this all that this does is it says okay let's take each of the chunks in the chunks folder and create summaries of it so i've got or here let's go let's go open one of them so alice in wonderland 14 so you see like uh it ends perhaps it doesn't understand english some children digging in the sand with wood and spades so then let's see what the result of that is um so we we've the chunks and summaries are one-to-one so every file in the chunks is represented in the summaries and what did i say 14 alice in wonderland 14. so let's go to alice in wonderland 14. and so alice finds herself in a pool of tears and meets a mouse she wonders if the mouse knows the way out and tries to ask it in english the mouse doesn't seem to understand but winks at her so you see like it takes this whole thing and summarizes it and so this is what i mean by in the next script where we've got recursive summaries so like because the over as you make it through the book even a two sentence summary like once you get to 40 of these that's going to be really long so we summarize the summaries that doesn't look like it worked too well that would probably require a um a specialized either prompt or fine-tuned model to summarize it correctly where it's just like okay what is the story so far give it to me in five sentences um other people have pointed out that maybe maybe there's um some people on i think it was reddit and youtube other techniques there's a lot of experimentation that can be done sounds like a lot of you have good ideas so i'm probably about done with this project so if you have ideas like please take a fork of this um and and try it out um you'll notice in the summarized chunks i had i have got a few things commented out it's because um i had already run it against these four books and i added three more so i just commented these out um to skip them um all right i skipped them and then i commented it out so that that way like you can see how the code was supposed to run same thing right here where the first time i ran it i only did the first 10 samples or 11. i my math logic was was wrong and so then i commented this out to skip it and then this is what i did to make it stop at 40 samples um yep so this the all that this does is fill up this folder the summaries folder uh so we're moving right along then the recursive summaries so this actually does two things um it it uh you see right here down at the end save file um the prompt uh is it fills up the prompt and completion folder so and basically it does a little bit of stuff to pull all the data together um all the other like the books the chunks the outlines all that um is pulled together into here so like outline alice is a young girl who falls asleep in a meadow story so far alice falls down a rabbit hole into a fantastical world where she had it has adventures with strange creatures and then it carries on obviously like the story so far because this is chunk number six probably needs to be a little bit more detailed but i bet if we go to the previous one yeah you see how it's four kilobytes so what happened was it had this summary and then it triggered to do the recursive summary so it says okay let's take this and then write a super concise summary let's put these in order so here's number five and then here's number six and i asked it to write a very concise summary and it did so it's like okay that's a little bit too concise right this is what i mean by like i'm gonna need to we're gonna need to work on a fine-tuned model that is that specializes in writing summaries that are like 1500 characters um regardless of how long it is um and i know that uh openai published a blog or a paper about recursive summarization so probably what i need to do is go review that and and copy their um their uh their success anyways um so that's that's the that's the most broken section is is doing these recursive summaries and here's here's how it that works that summary chunk actually why did i close those let me open these back up so these summary chunks are stored in this variable here summary chunk so when you start the book summary chunk is nothing so then for summary and summaries so that this list of summaries comes from this folder so for all of these we want to kind of inch along and then recursively summarize them and so then if the length of the summary when we add when we add the next one so accumulate all the summary so far if it's too long then we trigger then we trigger the summarizing the summaries thing um and so we open the file we open the the summary prompt and we put the chunk in and then we summarize it um and so basically the summary becomes really short this logic is going to be the most fragile part of this project so far so if you've got ideas about how to overhaul this i know a few of you have already commented on youtube and read it but if you've got other ideas or you want to try something on your own please take a copy of the code and try it out so at the end of this once this is done running we have the prompt and completions full and so then i just have this really short script that takes um takes the the contents from those prompts and completions and remember they're paired so the file name is identical under prompts and completion so like um if you look under um you know great gatsby 17 under prompts that one is paired with great gatsby 17 under completions um and that is how it knows which one goes where so it's like there's a bird on the lawn i think it must be a nightingale come over on the canard or white star line so you see where it's just like okay it just picks up right where it left off carries on um so we format the json l and then i've got my my standard fine tune script i just copy this into all of my uh projects let's see if it's done running still running okay so here's what we're going gonna do i'm gonna pause the video until this is done then we'll test out the fine-tuned model um again i don't expect it to work that that well but who knows maybe we'll be surprised i've got 280 samples for writing a novel i suspect that one we're going to need much better summaries like the the recursive summaries we're going to need to do that a lot better but also we're going to need a lot more samples this might be the kind of project that needs like 10 000 samples so that it knows the nuance of writing a novel in chunks anyways let me pause the video we'll come back once this is done and we'll test it out and go from there okay so i was thinking while this was running i wanted to do some back of the napkin math um also while while it's still running i just wanted to show a bunch of you ask like how much this costs um so like you see some of these big chunks are like days when i've done a lot of of projects um usually when you see these big jumps in in my spending that's because i fine-tuned a da vinci model but most of these only cost a few dollars so like here for the medical question chat bot that i trained it didn't fully work but it was only you know a dollar fifty to fine-tune a curie model so this is all relatively cheap anyways uh right now let's go back over to the playground so right now the text davinci o2 its maximum length is 4 000 tokens so my rule of thumb is that back when it was when the limit was 2000 or 2048 that was about 6 000 characters so that means each token is roughly three characters um that's a that's a rule of thumb that's not always true but so let's say let's say the current um davinci which is still gpd3 has a window size of 4000 tokens or 12 000 characters the average word in the english language is about 5.6 characters long i'm pulling that from memory i might be wrong so that is upwards of 2100 words so that means like da vinci like text davinci instructo 2 maximum theoretical output is probably 2 000 words gpt 4 is rumored to be coming out sometime this year so let's imagine that gpt4 is 10 times the size of gpt3 or has 10 times the window size so if that's true then we multiply that by 10 so that means gpt 4 could have a window size of 21 000 words um so let's say like because that would be 4 000 characters times 10 or sorry for 4 000 tokens because the current limit is tokens so what if gpt4 takes the token limit up to oh let me zoom in on this sorry you probably can't see um there we go so so let's say what if what if gpt4 you know text davinci o3 comes out in a few months and and the token limit is 40 000 right okay so then we take 40 000 multiply that by 3 because it's roughly 3 characters so that's 120 000 characters and then divide that by 5.6 to get 21 428 words um so that is you know a lot of what i'm doing where i'm trying to like summarize stuff into chunks of 1500 characters or less this is all going to be a moot point within a year um so this is this is all just like an exercise in futility um and then like you know because because this stuff goes up exponentially right okay it did succeed awesome so let's give it a try so this stuff goes up exponentially um so what happens in let's see tutor tutor scripts oh i probably need to do a reload um so what happens when you know when gpt 5 or 6 has a window size of let's say um probably like a million tokens right so a million tokens times 3 would be 3 million characters and you divide that by 5.6 that's 535 000 words right so that's like almost lord of the rings um that it could write in one shot so let's say let's say your average long novel is a hundred thousand words so you multiply that by 5.6 so your average long novel is 560 000 characters you divide that by three and you get we need a window size of 186 000 tokens in order to write an entire novel in one shot so you know all this work that i'm doing right now to try and you know get get gpt3 to write a whole novel this is an exercise in futility because you know 186 000 um let's divide that by by 4 000 so that's 46 times what we've got today and since this goes up exponentially this is probably two or three years away and gpt five or six or whatever will be able to write an entire novel in one shot and so then what we're going to be doing you know a year or two from now i won't be fine-tuning all these little chunks breaking it down into cognitive tasks we're going to be fine-tuning entire novels so all right with all that said let's see how we did today tutor tutor scripts novel there we go okay so let's grab one of these prompts let's just grab alice in wonderland 32 and uh this is gonna be comically bad i'm telling you um let's zoom out a little bit because there is a lot here okay so alice is a young girl all right alice falls down a rabbit hole and has adventures in a fantastical world etc etc um the caterpillar asks who alice is and she replies she doesn't quite know she feels she has changed several times since that morning the caterpillar tells alice to explain herself and alice tries but she cannot because she cannot understand herself okay so that's where we're at let's um let's increase this to a thousand excuse me a thousand tokens all right i'm going to turn the temperature down and let's just see what it spits out the first time because this is a fine-tuned model and also this is not necessarily a good test because it was trained on this data um but let's see while that's writing we were on which one did i open alice in wonderland 32 so let's see what the completion alice in wonderland 32 looks like and so this is this is again it's not entirely fair let's see different sizes in a day is very confusing it isn't well perhaps you haven't found so yet okay so let's just copy paste that so we can take a look okay it looks like it looks like it is very very similar here's another puzzling question alice couldn't think of any good reason so let's see if that is see if that's in here it isn't okay so it looks like the story is kind of diverging just a little bit i should think you'll feel it a little queer wouldn't you okay so it is like word for word up to a certain point that's not entirely unexpected because this is the data that it was trained on so let's okay now here's the real test let's see let's see how well this does on on a brand new story so this is this is really this is really the crux of it so let's go to the um to the premises that i created in another project so let's see so we've got an outline in a world of high fantasy a young woman named alicia is on a quest to save her village from a band of marauders alicia is joined by a group of unlikely heroes including a daring thief a powerful wizard and a skilled archer okay we got the four four-man band um they need a fifth one if they want to hold to the mythic structure um together they must battle their way through hordes of enemies and solve puzzles to reach the marauders lair with courage and determination they defeat the marauders and save the village okay story so far um opening nothing has happened last chunk chapter one next chunk all right let's see what it says i might need to turn the temperature up because we're asking it to be creative yeah it's just like uh [Music] let's just give you a bunch of spaces okay we'll turn the temperature back up to 0.7 it's probably going to be super super super confused it's thinking and it unloaded my model that's fine let's zoom in a little bit but yeah so once we get to um alicia and her uncle yeah okay so i don't think this project is gonna work um someone on on reddit or youtube said like oh well you should probably start with smaller chunks like short stories or flash fiction that's entirely possible i wanted to set the bar really high for myself and clearly i did let's go let's turn this down to 250 and let's turn the temperature up to turn it up to max i'm wondering why it just keeps outputting spaces that's like it's like it has no idea what to do um but yeah so and it unloaded my model again um yeah so if i were to do this over you know so one one reason that i started where i did is because we've got gutenberg which gives you like a crap ton of data um so it's like okay well we've got plenty of data to start with um but short stories or flash fiction would be um would be a little bit better uh because then what you do is like you know we we've oh here we go it's actually going now excellent god zukes okay um let's let this run so this this whole thing is only 380 tokens um which is not much so let's turn this completion up to 500. okay let's see what it wrote so far alyssia and her and her uncle alicia they're both the same name stood near the window looking out into the lovely garden it was a bright warm sunny day rosy rays of the sun were shining through the trees making checkered patterns of light and shade on the young girl's face wow this is not bad she had a book in her hand but she was not reading nothing in the world seemed interesting to alessia just then but then the butterflies that were fluttering about outside not bad there were several of them sitting on the branches of the fur trees near the house looking at alicia and whispering among themselves the little girl was quite sure what they that they were talking about her and the faint spot of color came to into each pink cheek as she looked back at them presently they flew away and alessia turned her eyes slowly from the fir trees to the sky where some white and gray pigeons were floating about she watched them until they too flew away and then she put her head down into a cluster of briony and honeysuckle which filled the window space with it with it with its fragrance and shining feathery green leave godzilla said a voice close by alyssia started violently and dropped the book on the floor um here i'll wait for it to finish but yeah so then um actually this might it might have just needed a really high temperature okay it's doing next chunk so what that tells us what we need to do is add this as a stop sequence okay um godzilla said a voice close to her alyssia started violently and dropped the book on the floor but seeing that the speaker was her old tortoise tortoiseshell kitten she recovered herself and took up the volume it was a large ancient book with faint ink marks and pieces cut out of the middle and leaves were of different sizes and some notched as if as if for a paper knife stay where you are she said to the kitten and i'll get you a mouse her face lit up at the thought the kitten lay on its back and wriggled its paws airily in the air while alicia opened the window leaned out and called to her sister at that mo at that moment dr primrose happened to look out his study window and he called he called to alicia to come in then in obedience to a whispered command the kitten jumped off the windowsill and hopped into the study where it vanished completely from alicia's site this is getting a little weird here master william cried alyssia master william where are you um i'm guessing that's dr primrose and she climbed into the study and found him on the table by the window come catch a mouse for suet this is so strange this is like very dreamlike okay so what we'll do then is we'll copy this so what i'm going to do is just kind of show you manually what i'll do with a script so we say okay um do actually let's copy this whole thing because we will ultimately use some of this um all right so let's switch back to davinci o2 and we'll say write a concise summary of the following the following story concise summary that temperature might be too high see it's it's making this up alyssia climbs into the study like that didn't happen okay so let's turn the temperature back down a little bit um okay that that lost some of it that's okay all right but that still served its purpose of giving us of a summary so it says alyssia is looking out the window uh when she sees some butterflies in pigeons suddenly her old tortoise shell kitten appears and startles her alyssia's sister calls her from the outside and alyssia climbs into the study to find the kitten okay so then what we'll do is we'll take that summary because that's the story so far and then last chunk is going to be the first chunk last chunk and so then we'll say next chunk and that will come back in here whoops and then we'll go back to our fine tune model whoops come back novel writer okay so now that it's actually populated this is going to look a little bit more familiar to the fine-tuned model so let's turn the temperature back up to one actually no let's leave it at 0.5 does that seem like it was okay now that it might have needed to have a higher temperature to get started because you recall it just gave me a bunch of spaces like i don't know what i'm doing um but now that it's got some actual some meat to chew on let's see what it says this is kind of fun funny okay um kitty she cried master williams sat up on the table and looked at her he was a large sleek black cat with a white patch on his throat and breast and white whiskers he had a very dignified manner and never played with kittens or even allowed them to come near him he was very well off having a large basket of white cotton wool to sleep on cotton wool wool comes from from sheep and a green box with holes in it for a bed and a little white saucer of milk by his side he was a very important person and never condescended to notice anyone but dr primrose oh so william master william and dr primrose are different okay alicia looked anxiously at her uncle as she came into the room but he was sitting with his back to her and did not turn around i've been calling you all more all the morning said alyssia taking master william off the table and i found such a lovely book what about what is it about said her uncle turning turning around to look at her oh about fairies and things said alyssia hugging the big book to her breast and there's this lovely story about a princess in a castle and a knight and a dragon and a wicked witch and a good fairy oh and such a lot of things what is the name of it said her uncle i don't know said alicia who had never troubled herself about the name of the book um and who had no idea that it have had any ever had sorry stuttering and who had no idea that it had ever had any other name other than book the book what is it about said her uncle again oh about everything there's a picture of a house and a picture of a bird and a picture of a train and a picture of a cow a picture of a boat blah blah i don't know what a curious book where did you find it okay so clearly this has learned to write some prose we have no idea when it's going to um get to the main story but this is a really great intro okay so i'm actually feeling somewhat encouraged so um i think i'm gonna pause the video actually let me see how long it is um we're at 31 minutes all right we're going to pause this now you've seen it work the data's out there feel free to fine-tune your own model and play with it but what i'm gonna do after this so when you come back for part four is i'm gonna make a script that will automate the parts that i just did manually and once those once those are um oh wow sorry i realized that this you were looking at my big face the whole time yep sorry about that um so what we'll do is i'll write the script in the next video to automate the generation of of whole stories and we'll see how far it gets um all right so with all that thanks for watching i hope you enjoyed this and i got some ideas thanks for watching like and subscribe etc etc see you next time