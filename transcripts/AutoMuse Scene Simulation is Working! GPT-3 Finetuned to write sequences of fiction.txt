hey everybody david shapiro here um let's see so earlier um i was well here let me just remind you so auto muse auto muse project is about um generating fiction automatically uh so yesterday or day before whenever it was we were generating um scenes so i generated a whole bunch of scenes um almost 700 samples of synthetic data and then we generated follow-up scenes so that's all up here on github let me zoom in a little bit so you can see it better um let me show you what the final product is so the final product is here's the here's the training data so the prompt is it's just a random scene and then the dmarc token is next paragraph and then a follow-up scene so oh and then there's a then there's a stop token right here and that's on all of them so you got the dmarc and stop token so that's the fine tuning data that we've got um so now let me just show you what it does so i asked gpt3 to write a tokenesque high fantasy and i've got it copied right here so what we'll do is um the trees stood like sentinels their leaves wrestling in the wind et cetera et cetera um okay so we'll what we'll do is we'll find slash space plus and replace that which is random space or a single space yep okay it was also said that wizards lived in the forest hiding from the world in their towers the main character a young boy named john so generic um let's change this to something a little more spicy we'll replace john with um stylus sure um my silas had always been fascinated by the stories of the forest he had often dreamed of visiting the forest and now finally he was going to get his chance silas his parents had been killed by a dragon oh that's exciting and had been taken in by the wizard gandalf we can't use gandalf no we'll replace gandalf with uh uh let's see well let's see uh hi zacks there we go it's a good wizard name kaizax told silas that he was special that he had the potential to be a great wizard and so on this night silas was getting out into the forest on a quest to find the dragons and wizards that lived there he was not afraid for he knew that he was the chosen one destined to save the world from the evil that was coming okay obviously it's a little over the top this is not exactly how it would work but so we'll say next paragraph let me just show you this is what it will do so let's grab the fine tune model i also have a character sim one um but it's not done fine fine-tuning it i think that uh i think that open ai is getting uh hammered because they're just they're way more popular than they used to be and so it takes a long time to get fine-tuning jobs done um let's see where is it email let's see this is the scene sim there it is scene sim okay so i've got the end here so it'll it'll just keep generating until it gets to the end um so let's go there we go there we go excellent um it stopped a little early so let's up that to a thousand tokens there's no time the woman said silas run okay cool the dragon is after you so it jumps right into the story that's fine but you can see where just uh because i fine-tuned it to have the pattern where it just it's going to continue generating a story it's ready to go so what am i going to do with this so think about links in a chain that's how we're that's how that's how i tried to do the novel writing last time but one it was a little overly complicated and two it um i didn't have enough training data so this is very similar to my my my novel writing effort there we go okay so what we're gonna do is i'll do view code um so it'll just shows like okay here's the model here's the prompt etc etc that's all fine so we'll copy that and what we're gonna do is we're gonna come to a new um scene simulation so then we're just going to do let's see uh right i don't want to say write novel but it's just we're just going to keep going like um yeah heck with it just it's after lunch my brain is off right novel dot pi okay so we will take a look at the generate scene so i'll copy some of the let's say i don't think i need uuid for this or i will need time and sleep and re okay let me just copy this open file save file yep okay i'm going to zoom out a little bit i had it zoomed way way way in all right so what are we doing what are we doing what are we doing we are going to grab so this is the ordinary completion function um so i'll have this here but then i'm also going to have um def um gpt3 fine tune um so then we'll do we'll keep this mostly the same actually here this is where i can copy this guy yeah model prompt etc etc etc yes that's all good whoops oh right okay so we will do the same so it'll be well here i'll just copy copy this no okay prompt so instead of engine we need to swap this out with model okay so i get this question a lot if you are following along and you cannot use my model this is in my account so you will have to go through and train this data yourself and that is in fine tune.pi so basically what you do is i'll have this commented but so you'll need to upload the scenes.jsonl file and fine tune your own model and then you can use the fine tune dot list in order to to look at your model or once it's trained up you can do what i did here which is you get it in your drop down and then you do view code and this is how you grab your model sorry i forget to say that often but it's very important you can't use my models open ai doesn't allow you to share fine tuned models there are very important safety reasons for that because if you don't know what's in the data you don't know how it's going to handle that right like i could fine-tune a model that is nice and benign and friendly and then but on certain things it just fails so there are really critical safety reasons why not to share models okay so with that then we replace this guy and we go from there okay and then the stop is just end ta-da that's good uh temperature we'll change that back down to 0.7 top p is one token's a thousand frequency presence all that is correct okay so this will be using the fine-tune model and then we will just grab all this it's going to be the same but so rather than have because here's the thing is instead of um [Music] see because it's completion create completion create but instead of engine you use model because you instead you call model i think they're changing it all so it'll all be model model but so we'll just replace model model and i think that's good okay that should be fine um yes okay so i'll just uh rather than monkey around with it i just got you know two pretty much identical functions um this is probably not the most efficient way but this is also the first time i'm trying to do it this way what is just happening okay i see all right so what are we doing i was telling you about the the chain link thing right so we've got this so we'll we'll grab this as our like as our genesis right our genesis block um our root all right not scene we need scene simulation there we go okay so we'll just call this uh story um yeah story and we'll have uh let's see genesis equals all right so that's the first one um all right so what are we trying to do what are we trying to do first if name equals main and some of you have asked why i do this i got in the habit of this because a long time ago long long time ago i did a lot of parallel work um with multi-processing and pools and if you don't do this every time you call a pool um or call you know call the it'll run everything in that function and it'll say oh you want me to run all this code again and you end up with really messy recursive stuff so i just got in the habit of putting the main chunk of my text under if name equals main it's not necessary i just got in the habit of it so i and i do that because it it also for me it forms this nice little handy thing it's like okay this is where my program starts that's the intention here okay so while true well first before we go into that loop we will say um so this the current story um story equals genesis and then we also i guess we don't need a summary yet although the prompt we have might know that the i i yeah okay so for the first one we're just gonna have yeah i gotcha okay so next chunk equals um next chunk equals gpt3 fine tune so this will be a fine-tuned completion and the prompt will be story plus new line new line next paragraph and so that matches what we put up here so next paragraph and you see that just having that it worked just fine um yep okay so it'll give us a next chunk so we'll do chunk and then next chunk um and i guess we do need to save this out so at what point do i save it um because we also want to like summarize as we go so when do we summarize so [Music] next chunk and then the summary i guess this will actually be previous chunk because it's inching forward right um okay so summary equals um actually hang on let me diagram this out because i'm a very visual thinker so let me let me let me do this real quick sorry about this okay here we go i've got a brief diagram so basically what i'm saying is like okay so we're going to summarize these chunks as we go and then we'll generate a new one so then once we have the summary we'll integrate it together and then generate a new one so the chunk that we use whoops come back here all right so the next chunk here i guess actually working backwards so next chunk equals gpd through fine tune so we're going to do summary summary plus and we'll do a space plus chunk and then next paragraph because what i want to do is we're going to summarize everything that we've got up until a certain point so the summary is going to include i guess actually next chunk yeah because the summary is going to have to be everything up to that point why is my brain not working in loops right now oh my god sorry okay um yes okay so next chunk equals summary uh chunk yes so then we need to get the summary and the chunk or i guess the the chunk is just gonna be next chunk right or am i being superfluous because the summary is going to be um well first we need prompt equals open file and we'll do prompt summary dot text replace um because we just we want to give it something and we're going to say okay replace the story with so what goes in here this the summary is going to be the last chunk so previous chunk it's actually going to be the summary the last summary right okay yeah so we will need we will need a summary here uh summary plus oops a space plus um next chunk right because this first summary is going to be well here so the first one when you instantiate it is going to be prompt equals oops prompt equals open file prompt summary and all that it's going to have is the first the first one and actually this is kind of superfluous so we'll just do genesis so this because this is the first instance of the cycle um and so then we're going to summarize do we summarize everything together so we're going to summarize genesis plus the next chunk right because we're summarizing them together this is everything that we've just written because then on the next loop so the summary equals um uh we're just going to do gbt3 completion ept3 completion prompt and this we will turn back down to 0.7 as well that should be fine okay so let me think um so then we've got the original chunk the next chunk and the summary but i'm wondering because then then when we get into the full loop so recursive programming was the thing that i failed at hardest back in computer science my brain does not think recursively i am sorry this is probably painful for people to watch who understand recursive programming better than i do and um i also blame the fact that it's after lunch so my brain is kind of off all right so we get the next chunk well here it might help if i actually just kind of run through it okay so then what do we do we take this so this is two chunks whoops don't need to save that and so then we say all right so we've got all this together um and so then what do we do we take this one we take a summary of this guy and then this one okay so we only summarize the previous chunk yeah because we'll want a summary of this and we'll concatenate it with this guy and then we'll generate the next chunk okay right got it i think so so we only summarize this so next chunk equals summarize the original so the summary is previous guy okay so now we have the summary and the next chunk so what we want to do is summary happens last and that's going to be the same but in this case the next chunk is going to be the summary plus whatever the next chunk was in the previous time next chunk and at some point we also have to save this right because the yeah the summary and so yeah okay i think i'm on to it get everything started and this is just because we're using genesis instead of next chunk because we need to get started we need to instantiate net next chunk and then the summary but really i wonder because this is pretty much identical so i wonder if i just call instead of genesis i wonder what happens if i just call because next chunk is generated from the summary and the previous instance of next chunk so if i just call this next chunk and then i instantiate summary summary equals that so then we start with next chunk so what this would end up is summary is null plus next chunk next paragraph so that generates the next thing oh but then we lose the genesis block so first that means we have to save file we'll do we'll do the file name will be story underscore time dot text and so that'll be time and then the content will be next chunk so that's when we save it we save it at the beginning of every loop right okay and then for this we'll do like four i in um list range zero to twenty not two twenty okay so the at the beginning of everyone we generate so we save a file so we save the chunk then we generate the next chunk and it's always it's always called next chunk because it's it's looping through and then we summarize so we load prompt summary.txt story summary uh we actually want to summer summarize we want to summarize it before yeah because if we take this we say okay so we've got this is this is the previous chunk i need to change the names that's what i need to do previous chunk equals next chunk yeah because we need we need to keep track of these two chunks separately so previous chunk equals next chunk so at the beginning of the loop previous chunk is this original guy then we say so then we save so actually i guess we're saving i guess they're the same at this point so then we have next chunk is this guy is the summary plus so the summary should be of previous chunk or the the next chunk should include it oh this is so confusing here we'll do this like range of two because i'll need to i'll need to look at the output um to make sure that i do this right this is probably so painfully boring i'm gonna pause it while i figure this out okay sorry for that i think i've got it so we'll do python write novel um so the trees stood like sentinels etc etc he's the chosen one destined to save the world so it's gonna run in the background um silas stepped into the forest the leaves crunching under his feet he took a deep breath filling his lungs um silas the chosen one i've come to meet the dragons the door opened and silas stepped into the tower so that's fun um silas stepped into the tower and the door closed behind him with a snap he was in a small windowless room with a single table and chair in the center the wizard said then let us begin the wizard led silas down a long winding staircase into a large underground chamber so this is good okay so we've got five steps here um didn't i count one two three four four steps okay so that was just a good little test so let me show you what went into this so the story is recorded here so we've got the the genesis block which is there plus the output here and then there is just a whoops then there's just a few things going on behind the scenes so let me just grab all of these and we'll do edit so the first thing is it uses the fine tune model to just generate the next next bit and then we say write a concise summary of this so it summarizes the previous bit and then it it adds that summary to the next generation so stepped into the forest and then so then we summarize all of that again and then we generate another story and then we summarize it again so it continuously summarizes everything that has happened up to that point and then adds to the story and so far it looks like it's pretty coherent um so let's delete this um and then i'll let it go for let's say 20 generations and then we'll call it a day because my head hurts um i'll probably do something to just like concatenate it all together but the way that i've got it written right now is that it'll show you as it's generating it um so yeah let's go ahead and just have this run and as long as it can have a coherent consistent store oh whoops crap i meant to change the uh the value no don't keep it here um so we'll go up to 20. so we're going to do 20 generations apologies story and then gbt3 logs okay it did cancel before it did anything okay good oops okay so we're going to do we're going to do 20 we're going to see how long it can keep up the story and keep it coherent one problem is that doing a concise summary so this prompt where it just says write a concise summary of the following um you often lose important details but we'll see hopefully it will it will keep details especially since it's adding as it goes um but yeah so let's kick this off um and then i'll come right back and we'll show you everything kind of brought together at the very end all right pausing now okay so we got stuck in in a loop i noticed this so it says silas set out into the forest on a quest to find the dragons and wizards and you see it's the wizards is in the same place all the way through so you see these patterns all right so why did this pattern happen let's go into gbt3 logs um uh yeah that's fine whoops so let's just close close all these and let's um look at let's look at the gpt3 logs um so you see they're all yeah it pretty much got stuck on repeat so we'll just open all of these summarize the following um the dragons fly away and silas knows he has won the battle okay it seems like it almost ended the story prematurely next paragraph yeah because if we look at the story let's just let's just look at the story um so the ground shook as the dragons descended from the tower silas could see their enormous size and knew that he was in for a fight he took a step uh forward and the ground shook again um yeah he took a deep breath and stepped forward this time the ground did not shake silas could see the dragon's eyes and he knew that he was getting through to them told them that he was the chosen one and he was going to save the world the dragons let out a loud roar and flew away he knew that he had won the battle and felt felt the power surging he was knew that he was ready to face the evil that was coming okay so it got stuck on repeat after just a few iterations because the story got to a place where it was kind of done okay interesting that's fine i'm actually not worried about this because this is just a single simulation that's running it's going to have multiple things happening such as multiple characters and then a world simulation going on so that's actually okay and because all we're doing is just kind of summarizing the previous one i wonder what happened so let's do an experiment now so this is fine as it is but let's do an experiment um where it kind of it kind of um converges that's the word where it converges um and this is something that i've noticed in other experiments where it converges very quickly whoops no close that um so what happens if we come out here and what happens if we remove the summary now i'm not going to worry about that because we do need to add multiple things in but i'm going to call this a day because this this is working this is this is getting there where you can see that it can generate one link after another but what we need to do is we need to add a little bit more information not just a summary and the previous chunk what we need to do is we need to add other characters and other stuff happening in the world but you can see that given any particular chunk of story it can continue the story um but we need to we need to add enough so that it'll keep going because obviously if it just gets stuck in a loop after three or four generations that's not good enough that's fine i didn't expect it to do any better because this is just a cog in a larger machine so anyone anyways thanks for watching like and subscribe and consider supporting me on patreon