hey everybody david shapiro here for another tutorial video today we are going to go over um fine tuning 101 data prep so uh if you've watched my other videos you know that i'm a big fan of synthetic data sets especially because one it's fast two it's relatively cheap and three you get exactly what you want so what i want to do is show you an example of how to get synthetic data now one thing to keep in mind with fine tuning is that you're not actually training the model to do anything new gpt3 is already trained on many hundreds of gigabytes worth of data everything that you ask it to do it already knows how to do so the purpose of fine tuning is to narrow down to say do this one thing every time now because fine tuning is about removing possibilities you want to make sure that your fine tuning data has a broad variety so that it has seen many examples um and we'll get into advanced fine tuning techniques later um i'll probably do a video going over my question generating um bot because the more variety you show for the input and the more and the more examples you give in terms of that breadth of variety and like different formats the better it will perform now when you're doing synthetic data in the way that i'm about to show you it's a very consistent format but anyways so i wanted to start with something very simple which was just imagine a complete and detailed plot synopsis for a blank you know genre set in a location during a time and then the story should be uh you know add a couple modifiers write out the entire plot premise in great detail um now unfortunately uh the instruct series models are not the best at going in at long form writing but you see this one's okay it's doing all right um so it does a pretty good job it's almost like a movie poster it's not actually like writing out the story um but this is good enough for now um with a little bit more prompt engineering um here actually let's try it let's instead of premise let's say outline and see if that modifies it um yeah that looks like it's a little bit more detailed um but it's still not actually writing the whole story um because part of the problem is that gpt3 was not trained on actual like plot outlines and actually if you watch my other videos um getting getting gpt3 to actually write fiction is really difficult so i'll modify the prompt to say instead of premise i'll say plot outline um and we'll just change this here as well so we're going to say write plot outlines okay so we've got this this is the prompt that i'm going to use and i'm going to auto populate it with different things so this is a really quick way to get a broader variety of data is where you ask it to do kind of the same prompt but you give it a bunch of different modifiers um so effectively what i'm going to do is give it you know 200 different prompts and i'm going to record that output and then use that for fine tuning data and so the scripts that i've got oops uh is here here i did something wrong okay the script that i've got is synthesize plots um so what i've got is i've got a list of genres a list of modifiers a list of places and a list of periods so you get all this you can get a lot of variety you can get a lot of combinations the first time i ran it i had uncommented all these and it was like going to generate 2 000 different samples i'm not going to spend that much on a tutorial video so i cut it down to four by four by four by four so four to the fourth power is 256. so i've got four examples of each of each thing and then you might also notice that i've got the up here the uuid so uuid let me just show you what it looks like oops synthesize slots there we go okay so this is this is showing you the the prompts that it's going to run so it starts with a uuid up at the top a uu id is just a random string of hexadecimal characters but one thing that i found is that this does a really good job of of causing gpt3 to have a little bit more internal entropy by starting it with a uuid it's like okay i'm reading this i don't i don't know how to make sense of it so it's trying to create an internal state that doesn't make any sense so you you you prime it to be a little bit more different a little bit more random this is especially good if you need to run the same prompt over and over and over again so you do this in combination with a high temperature and you'll get a lot more variety but anyways you can see where it's populated out imagine a complete and detailed plot outline for a science fiction film set in india during the 1990s the story should be supernatural and otherworldly write out the entire plot write out the entire plot outline in great detail and then you see the number here 256. so if you go back here you say i just did a quick count to keep track of how many it generated just to show you that's what it's doing so we can comment this out since we don't need this um and then what we'll do is i have some some canned functions that i use so here's the uh here's the gpt3 completion um use text davinci o2 temperature one top p of one token's a thousand it's not generating anywhere near that much um and then we'll save we'll save all this out to gpt3 logs but then what are we going to do with the actual prompt and completion right because for fine tuning you need a prompt and a completion and we're not going to just record these prompts what would be the point of that we're not actually adding anything so what we got to do is we're going to then format a prompt to look a little bit different so we'll say completion equals gpt3 completion and then we'll beat in my prompt but i've got all i've got the genre the modifier the place and the period so what i want to do is i'll save the um the out the um the out prompt as it'll be a text that uh basically what i'll do is i'll just say um uh let's see genre equals that and then newline and then i'll say location is dollar s and so this dollar s i'll show you what i'm going to do with this in just a second genre location period and then and then modifier and so then we'll do that and then we'll do newline new line and then we'll do lot outline and then we'll add a little space and so basically what this will look like let me show you what the what the actual final prompt will look like um so instead of this it will have location period modifier and then double new line um plot outline and so it'll be like you know sci-fi or i guess i had it out as um science fiction location will be india period will be um the renaissance um and then the modifier will be like cerebral and what did i say like spooky or whatever um uh cerebral and suspenseful okay okay so given just these little bit of information um like if i just if i just put this into gpt3 right now it's it'll probably work a little bit oh i've misspelled suspenseful where did did i misspell that here i was just here okay i don't think i misspelled it up here um suspenseful yeah correct okay um it'll probably figure out what i want to do okay yeah so because it's fine-tuned um it can figure it out um it's not the best uh it certainly is just a plot premise it's not as complete as what was generated before but also this is with text davinci o2 which is already fine-tuned to follow instructions uh another thing that you can do is once you generate data and we'll get into this let me do a quick time check actually um okay eight minutes we've got just a few minutes left um you can also go in and augment stuff so one thing that i like to do is um go to the edit model which is free right now at least it was and you can say like make this more detailed so let's um whoops that's not what i meant to do ah darn it got rid of what i what i wrote okay anyways point being i'll show you i'll show you the edit endpoint and this will be in an advanced uh tutorial as well anyways let's go back to our work um okay so we've got the completion so this is going to be the actual plot synopsis and then the out prompt is this and i showed you what this is going to look like here oh yeah here let me just go ahead and show you so we'll give it we'll get a plot outline an alternate history in india oh now this is fun um so apparently india invents ai during the renaissance that's kind of cool actually all right so here's here's a here's a food for thought later on you can use the edit endpoint and so we'll say let's see expand this plot outline to include more detail um make it a complete story and we'll turn the temperature all the way up because higher temperature generally leads to more creativity it can also lead to some random stuff that you don't want but anyways so another thing that you can do in in preparing your data is you can use the edit endpoint to further augment the data so by baking in multiple steps you can then have a data set that is trained to do more stuff oh here we go so this is a much longer plot synopsis so this is perfect i'm not going to do this this time but just i wanted to show you that this is a thing you can do you can use the edit endpoint to further augment your training data so this is great um let's see delighted in the stories acetics transmutation i think it actually did like an entirely different story okay um i don't know that it actually uh yeah okay the like i said if you have the really high temperature you can get stuff that you really don't do not expect um all right moving on we'll come back to uh augmenting techniques in a later video okay so here we are this is what we want the the prompt to look like so this is what we're going to record and then the output will just be the completion um and so then what we do is we'll do save file and actually let's do a file name real quick file name equals time plus dot text actually no file name will be will be uh let's see i need to remove the ands from it so we'll do what's the shortest one so we'll do place um place period genre okay yeah place plus period plus genre plus modifier um and then we will because each one of these is going to be unique it's only going to touch it once so then we'll do replace space with nothing and then we'll also do replace the and sign because i don't think i don't think it'll save that as a file and then we'll add dot text and then we'll do save file so the content of the file will be um wait make sure i file path is first okay so f uh so we're going to save the prompt out to prompt and then we'll do uh percent file name and then we'll do out prompt and then we'll do save file so basically what i'm doing is i'm saving the prompt and completion with the same file name but to different folders so then we'll do completions dollar s or a percent s percent file name and then completion um and there you have it that should be it um so what i like to do is for a quick debug because you obviously before you spend a lot of tokens you want to make sure it works right um so i i print out the prompt here but then let's also um just so we can watch while it's going here we'll do we'll just copy this so we'll do print out prompt and then print completion because why not you know if you're bored and you're watching your data run why not just do it okay so let's do cls to clear the screen um oops you have to wrap the text in actual quotations okay so we'll let it generate one and then we'll see what happens so this is a romance and comedy set in france during the renaissance this should be fun oh i forgot to do a thing um yeah i bet i bet this i bet it didn't look right so this is why you check your work so during the renaissance in france two lovers pierre and maria must overcome tremendous obstacles to be together their families rival noble our rival noble houses oh this is fun um war is brewing this sounds like war on the fondane um undaunted pier and murray made in secret planning to elope betrayed by one of murray's maidservants oh this is fun jealous older brother henry in a fierce battle they are mortally wounded and marie's art dies in murray's arms and he tells her to flee marie lu refuses so yeah this is this is romance and comedy um i don't really see much comedy in here as the lover's souls depart this world they vow to find each other again in the next life so it looks like the the modifier is kind of hijacking it i don't really see how you could make the i mean it's certainly romance but it's not a comedy so sometimes these things are conflicting but let's check the output data to make sure that it did what i expected okay so the completion looks right um i like how it's france the renaissance romance comedy cerebral suspenseful.txt [Laughter] you know exactly what you're getting um okay so that's good the completion looks right but i think the prompt is wrong yeah that's not what i wanted um okay so let's fix that let's um actually yeah let's just go ahead and delete that and delete the completion it'll regenerate it um anyways uh no don't keep it in no don't keep it in um okay so out prompt oh that's what i forgot to do so um you do the percent and then when you have multiple placeholders you need to do um you need to put it in an iterable like this so we do um period oh no genre look uh place period modifier so that should be right and that's that should be fully populated um okay so then let's run this again just to make sure let's make this a little bigger so here's the initial input and it'll take a second oh this is much longer much better much better okay so um here's the initial input here's how we're reformatting that input so it'll be like this and then this is the output when catherine de medici is widowed this is italy she's a skilled politician but not well loved so this is much longer this is what we would kind of want to see um so let's go make sure that the data looks right so the completion here it is um there we go completions and then prompts and there's the prompt um and so then what you do after this is you just you remove the escape um and you let it go and you've synthesized data and we are at 17 minutes so this is a little bit longer than i try and make my tutorials so the last thing is just do this and let it run so i will go ahead and set this to run and then tune in for the next video where we'll go over data prep and i think probably what i'll do is talk about data augmentation and cleanup at that time because that's all part of data prep so anyways thanks for watching tune in again and i'll see you all again soon